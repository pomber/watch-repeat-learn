<link rel="import" href="../bower_components/polymer/polymer.html">
<!--
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
-->
<link rel="import" href="../bower_components/google-youtube/google-youtube.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-icons/av-icons.html">

<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="wrl-app">

  <template>

    <style>

      :host {
        display: block;
      }
      
      paper-fab {
          position: fixed;
          right: 25px;
          bottom: 30px;          
          z-index: 10;
      }
      
      .split {
          background: white;
          margin: 4px 0px;
      }

    </style>
<!--
    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>
-->
        
    <paper-fab 
        id="fab"
        icon="av:play-arrow"
        on-tap="_toggleState">
    </paper-fab>
        
    <google-youtube id="video"
        video-id="DpbEg-zVcpU" 
        chromeless fluid>
    </google-youtube>
    
    <template is="dom-repeat" items="{{splits}}">
        <paper-item raised class="split">
            <paper-item-body two-line>
                <div>From {{item.start}} to {{item.end}}</div>
                <div secondary>Jan 17, 2014</div>
            </paper-item-body>
            <paper-icon-button icon="av:play-arrow">
            </paper-icon-button>
        </paper-item>
    </template>   
        

  </template>

  <script>

    Polymer({

      is: 'wrl-app',

      properties: {
          splits: {
              type: Array,
              value: []
          },
      },

      observers: [
        // '_routePageChanged(routeData.page)'
      ],

      listeners: {
        'google-youtube-state-change': '_onStateChange',
      },

    //   _routePageChanged: function(page) {
    //     console.log("Route changed: " + page);
    //   },
      
      _toggleState: function() {
          var video = this.$.video;
          if (video.state !== 1) {
            video.play();
          } else {
            video.pause();
            
            var start = this.splits.length ?
                this.splits[0].end : 0;
        
            var split = {
                start: start,
                end: video.currenttime,
            };
            
            this.unshift("splits", split);
          }
      },
      
      _onStateChange: function(e) {
          var state = e.detail.data;
          if (state == 1) {
              this.$.fab.icon = "av:pause";
          } else {
              this.$.fab.icon = "av:play-arrow";
          }
      },

    });

  </script>

</dom-module>
